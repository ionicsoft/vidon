<div class="container">
  <%= render "flash_notice" %>
<div>
  <h1 class="show_title" style="color:black;">
    <%= @show.name %>
    <% if @show.promo_image.attached? %>
        <%= image_tag(url_for(@show.promo_image), :alt => "Promo Image", :style => "height: 400px; width: 300px;") %>
    <% else %>
        <%= image_tag("nullPhoto.png", :alt => "nullPhoto", :style => "height: 400px; width: 300px;") %>
    <% end %>
  </h1>
  
  <h2 class="show_description">
    <% if logged_in? && current_person.customer? %>
    <p>
      <ul class="show_navbar_nav">
        <li>
          <% if !current_person.user.has_subscription?(@show) %>
            <button type="button" class="btn btn-info" data-toggle="modal" data-target="#exampleModal">
              Subscribe
            </button>
            <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
              <div class="modal-dialog" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title text-body" id="exampleModalLabel">Subscribe to <%= @show.name %></h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                      <span aria-hidden="true">&times;</span>
                    </button>
                  </div>
                  <% if current_person.user.open_slots? %>
                    <div class="modal-body text-body">
                      You have <span class="text-warning"><%= current_person.user.open_slots %></span> available subscription slots remaining.
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                      <%= button_to "Subscribe", subscriptions_path,
                        params: { subscription: { customer_id:
                        current_person.user.id, show_id: @show.id} },
                        class:"btn btn-primary" %>
                    </div>
                  <% else %>
                    <div class="modal-body text-body">
                      You do not have any available subscription slots. You can 
                      purchase an additional slot for $2. Select "Purchase" to 
                      add a new slot and subscribe to this show.
                    </div>
                    <div class="modal-footer">
                      <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
                      <%= button_to "Purchase", subscriptions_path,
                        params: { subscription: { customer_id:
                        current_person.user.id, show_id: @show.id}, purchase: true },
                        class:"btn btn-warning" %>
                    </div>
                  <% end %>
                </div>
              </div>
            </div>
          <% end %>
        </li>
        <li>
          <%= link_to "Play", @show.episodes.find_by(absolute_episode: "1").video, class: "btn btn-primary" %>
        </li>
      </ul>
      <br />
    </p>
    <% end %>
    <p id="sm-text">
      <strong>Description:</strong>
      <%= @show.description %>
    </p>
    
    <% if current_person.customer? %>
      <p id="sm-text">
        <strong>Genres:</strong>
        <% @genres = ShowGenre.all.where(show_id: @show.id)%>
        <% @genres.each do |genre| %>
          <% if genre == @genres.last %>
            <%= genre.genre %>
          <% else %>
            <%= genre.genre + ", "%>
          <% end %>
        <% end %>
      </p>
      
      <p id="sm-text">
        <strong>Actors:</strong>
        <% @actors = ShowActor.all.where(show_id: @show.id)%>
        <% @actors.each do |actor| %>
          <% if actor == @actors.last %>
            <%= actor.name %>
          <% else %>
            <%= actor.name + ", "%>
          <% end %>
        <% end %>
      </p>
    
    <% end %>
    
    <% unless @show.producer.nil? %>
    <p id="sm-text">
      <strong>Producer:</strong>
      <%= @show.producer.company_name %>
    </p>
    <% end %>
    
    <% if current_person.customer? %>
      <p>
        <%= link_to 'Return to shows', browse_path, {:style=>'color:#FFFFFF;', :class => "css_class"} %>
      </p>
    <% else %>
      <p>
        <%= link_to 'Return', pro_shows_path, {:style=>'color:#FFFFFF;', :class => "css_class"} %>
      </p>
    <% end %>
    </h2>
</div> 

<% if current_person.producer? and @show.producer == current_person.user %>
    <div class="col" id="profile-comments">
      <div class="card card-default">
        <div class="card-body">
          <h4 id="card-text">Actors</h4>
          <hr>
          <% if @show.show_actors.any? %>
            <% @show.show_actors.each do |actor| %>
              <div class="mb2">
                <small style="color:black;"><%= actor.name %></small>
                <%= link_to 'Edit', edit_show_actor_path, class: "btn btn-primary btn-large" %>
                <%= link_to 'Delete', actor, class: "btn btn-primary btn-large", method: :delete, data: { confirm: 'Are you sure?' } %>
              </div>
            <% end %>
          <% end %>
          <div>
            <hr>
            <%= render 'show_actor_form' %>
          </div>
        </div>
      </div>
    </div>
    <div class="col" id="profile-comments">
      <div class="card card-default">
        <div class="card-body">
          <h4 id="card-text">Genres</h4>
          <hr>
          <% if @show.show_genres.any? %>
            <% @show.show_genres.each do |genre| %>
              <div class="mb2">
                <small style="color:black;"><%= genre.genre %></small>
                <%= link_to 'Edit', edit_show_genre_path, class: "btn btn-primary btn-large" %>
                <%= link_to 'Delete', genre, class: "btn btn-primary btn-large", method: :delete, data: { confirm: 'Are you sure?' } %>
              </div>
            <% end %>
          <% end %>
          <div>
            <hr>
            <%= render 'show_genre_form' %>
          </div>
        </div>
      </div>
    </div>
    <% end %>

<div class="episodes_list">
  <h3 id="sm-text">Episodes</h3>
  <ul>
    <% @show.episodes.each do |episode| %>
    <li>
      <p class="episodes_list_image">
        <% if episode.video.thumbnail.attached? %>
          <%= image_tag(url_for(episode.video.thumbnail), :alt => "Promo Image", :style => "height: 100px; width: 100px;") %>
        <% else %>
          <%= image_tag("nullPhoto.png", :alt => "Thumbnail", :style => "height: 100px; width: 100px;") %>
        <% end %>
      </p>
    
      <div class="episodes_description">
        <h3 id="sm-text"><%= episode.episode %> <%= episode.video.title %></h3>
        <p id="sm-text">
          <%= episode.video.description %>
          <br/>
          <% if current_person.customer? %>
            <%= link_to 'Watch', episode.video, class: "btn btn-primary btn-large" %>
          <% elsif current_person.user == @show.producer %>
            <%= link_to 'Delete Episode', episode, class: "btn btn-primary btn-large", method: :delete, data: { confirm: 'Are you sure?' } %>
          <% end %>
          
        </p>
      </div>
    </li>
    <% end %>
    
    <% if current_person.producer? and current_person.user == @show.producer %>
      <%= link_to 'Add Episode', new_episode_path(show_id: @show.id), class: "btn btn-primary btn-large" %>
      <%= link_to 'Edit Show', edit_show_path, class: "btn btn-primary btn-large" %>
      <%= link_to 'Delete Show', @show, class: "btn btn-primary btn-large", method: :delete, data: { confirm: 'Are you sure?' } %>
    <% end %>
    
    
  </ul>
</div>
</div>
  

